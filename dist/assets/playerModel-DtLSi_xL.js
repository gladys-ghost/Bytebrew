import{T as At,a as Ce,b as Je,L as Tt,c as oe,F as et,C as $,d as N,S as Pe,P as ke,D as tt,M as ne,e as re,f as v,V as De,g as fe,h as x,I as bt,i as Et,O as xe,j as st,k as Rt,B as be,l as St,m as nt,n as it,R as q,o as Mt,p as Ee,q as Ct,r as W,s as ot,t as kt,u as Lt,v as It,w as z,x as _t,y as Bt,z as vt,A as Ot,G as B,E as rt,H as Pt,J as Dt,K as Ft,N as Le,Q as Nt,U as at,W as Ge,X as Ae,Y as Gt,Z as Ht,_ as jt,$ as Kt,a0 as Ut,a1 as zt,a2 as Wt,a3 as Vt,a4 as Xt,a5 as He,a6 as je,a7 as Ke,a8 as Ue,a9 as C,aa as qt,ab as Yt,ac as ge,ad as $t,ae as lt,af as Ie,ag as Qt,ah as Zt,ai as ct,aj as Jt,ak as es,al as ze,am as ts,an as ss,ao as ns,ap as is}from"./index-D9TqFLhf.js";function We(l,e){if(e===At)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===Ce||e===Je){let t=l.getIndex();if(t===null){const i=[],a=l.getAttribute("position");if(a!==void 0){for(let r=0;r<a.count;r++)i.push(r);l.setIndex(i),t=l.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l}const s=t.count-2,n=[];if(e===Ce)for(let i=1;i<=s;i++)n.push(t.getX(0)),n.push(t.getX(i)),n.push(t.getX(i+1));else for(let i=0;i<s;i++)i%2===0?(n.push(t.getX(i)),n.push(t.getX(i+1)),n.push(t.getX(i+2))):(n.push(t.getX(i+2)),n.push(t.getX(i+1)),n.push(t.getX(i)));n.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=l.clone();return o.setIndex(n),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}class ee extends Tt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new cs(t)}),this.register(function(t){return new hs(t)}),this.register(function(t){return new xs(t)}),this.register(function(t){return new As(t)}),this.register(function(t){return new Ts(t)}),this.register(function(t){return new us(t)}),this.register(function(t){return new ms(t)}),this.register(function(t){return new ps(t)}),this.register(function(t){return new fs(t)}),this.register(function(t){return new ls(t)}),this.register(function(t){return new gs(t)}),this.register(function(t){return new ds(t)}),this.register(function(t){return new ws(t)}),this.register(function(t){return new ys(t)}),this.register(function(t){return new rs(t)}),this.register(function(t){return new bs(t)}),this.register(function(t){return new Es(t)})}load(e,t,s,n){const o=this;let i;if(this.resourcePath!=="")i=this.resourcePath;else if(this.path!==""){const c=oe.extractUrlBase(e);i=oe.resolveURL(c,this.path)}else i=oe.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),o.manager.itemError(e),o.manager.itemEnd(e)},r=new et(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(c){try{o.parse(c,i,function(d){t(d),o.manager.itemEnd(e)},a)}catch(d){a(d)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let o;const i={},a={},r=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(r.decode(new Uint8Array(e,0,4))===ht){try{i[y.KHR_BINARY_GLTF]=new Rs(e)}catch(h){n&&n(h);return}o=JSON.parse(i[y.KHR_BINARY_GLTF].content)}else o=JSON.parse(r.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Fs(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const h=this.pluginCallbacks[d](c);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[h.name]=h,i[h.name]=!0}if(o.extensionsUsed)for(let d=0;d<o.extensionsUsed.length;++d){const h=o.extensionsUsed[d],u=o.extensionsRequired||[];switch(h){case y.KHR_MATERIALS_UNLIT:i[h]=new as;break;case y.KHR_DRACO_MESH_COMPRESSION:i[h]=new Ss(o,this.dracoLoader);break;case y.KHR_TEXTURE_TRANSFORM:i[h]=new Ms;break;case y.KHR_MESH_QUANTIZATION:i[h]=new Cs;break;default:u.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}c.setExtensions(i),c.setPlugins(a),c.parse(s,n)}parseAsync(e,t){const s=this;return new Promise(function(n,o){s.parse(e,t,n,o)})}}function os(){let l={};return{get:function(e){return l[e]},add:function(e,t){l[e]=t},remove:function(e){delete l[e]},removeAll:function(){l={}}}}const y={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class rs{constructor(e){this.parser=e,this.name=y.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const o=t[s];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const o=t.json,r=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let c;const d=new $(16777215);r.color!==void 0&&d.setRGB(r.color[0],r.color[1],r.color[2],N);const h=r.range!==void 0?r.range:0;switch(r.type){case"directional":c=new tt(d),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new ke(d),c.distance=h;break;case"spot":c=new Pe(d),c.distance=h,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,c.angle=r.spot.outerConeAngle,c.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return c.position.set(0,0,0),c.decay=2,D(c,r),r.intensity!==void 0&&(c.intensity=r.intensity),c.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(c),t.cache.add(s,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,o=s.json.nodes[e],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(r){return s._getNodeRef(t.cache,a,r)})}}class as{constructor(){this.name=y.KHR_MATERIALS_UNLIT}getMaterialType(){return ne}extendParams(e,t,s){const n=[];e.color=new $(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const i=o.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],N),e.opacity=i[3]}o.baseColorTexture!==void 0&&n.push(s.assignTexture(e,"map",o.baseColorTexture,re))}return Promise.all(n)}}class ls{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class cs{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&o.push(s.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&o.push(s.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(o.push(s.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const a=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new De(a,a)}return Promise.all(o)}}class hs{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_DISPERSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}}class ds{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.iridescenceFactor!==void 0&&(t.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&o.push(s.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(t.iridescenceIOR=i.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&o.push(s.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(o)}}class us{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new $(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=n.extensions[this.name];if(i.sheenColorFactor!==void 0){const a=i.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],N)}return i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&o.push(s.assignTexture(t,"sheenColorMap",i.sheenColorTexture,re)),i.sheenRoughnessTexture!==void 0&&o.push(s.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(o)}}class ms{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&o.push(s.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(o)}}class ps{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&o.push(s.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||1/0;const a=i.attenuationColor||[1,1,1];return t.attenuationColor=new $().setRGB(a[0],a[1],a[2],N),Promise.all(o)}}class fs{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class gs{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&o.push(s.assignTexture(t,"specularIntensityMap",i.specularTexture));const a=i.specularColorFactor||[1,1,1];return t.specularColor=new $().setRGB(a[0],a[1],a[2],N),i.specularColorTexture!==void 0&&o.push(s.assignTexture(t,"specularColorMap",i.specularColorTexture,re)),Promise.all(o)}}class ys{constructor(e){this.parser=e,this.name=y.EXT_MATERIALS_BUMP}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return t.bumpScale=i.bumpFactor!==void 0?i.bumpFactor:1,i.bumpTexture!==void 0&&o.push(s.assignTexture(t,"bumpMap",i.bumpTexture)),Promise.all(o)}}class ws{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:v}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.anisotropyStrength!==void 0&&(t.anisotropy=i.anisotropyStrength),i.anisotropyRotation!==void 0&&(t.anisotropyRotation=i.anisotropyRotation),i.anisotropyTexture!==void 0&&o.push(s.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(o)}}class xs{constructor(e){this.parser=e,this.name=y.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const o=n.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,i)}}class As{constructor(e){this.parser=e,this.name=y.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=o.extensions[t],a=n.images[i.source];let r=s.textureLoader;if(a.uri){const c=s.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,i.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Ts{constructor(e){this.parser=e,this.name=y.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=o.extensions[t],a=n.images[i.source];let r=s.textureLoader;if(a.uri){const c=s.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,i.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class bs{constructor(e){this.name=y.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],o=this.parser.getDependency("buffer",n.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(a){const r=n.byteOffset||0,c=n.byteLength||0,d=n.count,h=n.byteStride,u=new Uint8Array(a,r,c);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(d,h,u,n.mode,n.filter).then(function(m){return m.buffer}):i.ready.then(function(){const m=new ArrayBuffer(d*h);return i.decodeGltfBuffer(new Uint8Array(m),d,h,u,n.mode,n.filter),m})})}else return null}}class Es{constructor(e){this.name=y.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const n=t.meshes[s.mesh];for(const c of n.primitives)if(c.mode!==I.TRIANGLES&&c.mode!==I.TRIANGLE_STRIP&&c.mode!==I.TRIANGLE_FAN&&c.mode!==void 0)return null;const i=s.extensions[this.name].attributes,a=[],r={};for(const c in i)a.push(this.parser.getDependency("accessor",i[c]).then(d=>(r[c]=d,r[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const d=c.pop(),h=d.isGroup?d.children:[d],u=c[0].count,m=[];for(const g of h){const A=new fe,f=new x,w=new Ae,E=new x(1,1,1),M=new bt(g.geometry,g.material,u);for(let T=0;T<u;T++)r.TRANSLATION&&f.fromBufferAttribute(r.TRANSLATION,T),r.ROTATION&&w.fromBufferAttribute(r.ROTATION,T),r.SCALE&&E.fromBufferAttribute(r.SCALE,T),M.setMatrixAt(T,A.compose(f,w,E));for(const T in r)if(T==="_COLOR_0"){const O=r[T];M.instanceColor=new Et(O.array,O.itemSize,O.normalized)}else T!=="TRANSLATION"&&T!=="ROTATION"&&T!=="SCALE"&&g.geometry.setAttribute(T,r[T]);xe.prototype.copy.call(M,g),this.parser.assignFinalMaterial(M),m.push(M)}return d.isGroup?(d.clear(),d.add(...m),d):m[0]}))}}const ht="glTF",se=12,Ve={JSON:1313821514,BIN:5130562};class Rs{constructor(e){this.name=y.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,se),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ht)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-se,o=new DataView(e,se);let i=0;for(;i<n;){const a=o.getUint32(i,!0);i+=4;const r=o.getUint32(i,!0);if(i+=4,r===Ve.JSON){const c=new Uint8Array(e,se+i,a);this.content=s.decode(c)}else if(r===Ve.BIN){const c=se+i;this.body=e.slice(c,c+a)}i+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ss{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=y.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},r={},c={};for(const d in i){const h=_e[d]||d.toLowerCase();a[h]=i[d]}for(const d in e.attributes){const h=_e[d]||d.toLowerCase();if(i[d]!==void 0){const u=s.accessors[e.attributes[d]],m=Z[u.componentType];c[h]=m.name,r[h]=u.normalized===!0}}return t.getDependency("bufferView",o).then(function(d){return new Promise(function(h,u){n.decodeDracoFile(d,function(m){for(const g in m.attributes){const A=m.attributes[g],f=r[g];f!==void 0&&(A.normalized=f)}h(m)},a,c,N,u)})})}}class Ms{constructor(){this.name=y.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Cs{constructor(){this.name=y.KHR_MESH_QUANTIZATION}}class dt extends Yt{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,o=e*n*3+n;for(let i=0;i!==n;i++)t[i]=s[o+i];return t}interpolate_(e,t,s,n){const o=this.resultBuffer,i=this.sampleValues,a=this.valueSize,r=a*2,c=a*3,d=n-t,h=(s-t)/d,u=h*h,m=u*h,g=e*c,A=g-c,f=-2*m+3*u,w=m-u,E=1-f,M=w-u+h;for(let T=0;T!==a;T++){const O=i[A+T+a],G=i[A+T+r]*d,_=i[g+T+a],te=i[g+T]*d;o[T]=E*O+M*G+f*_+w*te}return o}}const ks=new Ae;class Ls extends dt{interpolate_(e,t,s,n){const o=super.interpolate_(e,t,s,n);return ks.fromArray(o).normalize().toArray(o),o}}const I={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Z={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Xe={9728:Gt,9729:nt,9984:Ht,9985:jt,9986:Kt,9987:it},qe={33071:Ut,33648:zt,10497:q},Re={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_e={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},j={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Is={CUBICSPLINE:void 0,LINEAR:at,STEP:Wt},Se={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function _s(l){return l.DefaultMaterial===void 0&&(l.DefaultMaterial=new W({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Vt})),l.DefaultMaterial}function X(l,e,t){for(const s in t.extensions)l[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function D(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Bs(l,e,t){let s=!1,n=!1,o=!1;for(let c=0,d=e.length;c<d;c++){const h=e[c];if(h.POSITION!==void 0&&(s=!0),h.NORMAL!==void 0&&(n=!0),h.COLOR_0!==void 0&&(o=!0),s&&n&&o)break}if(!s&&!n&&!o)return Promise.resolve(l);const i=[],a=[],r=[];for(let c=0,d=e.length;c<d;c++){const h=e[c];if(s){const u=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):l.attributes.position;i.push(u)}if(n){const u=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):l.attributes.normal;a.push(u)}if(o){const u=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):l.attributes.color;r.push(u)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(r)]).then(function(c){const d=c[0],h=c[1],u=c[2];return s&&(l.morphAttributes.position=d),n&&(l.morphAttributes.normal=h),o&&(l.morphAttributes.color=u),l.morphTargetsRelative=!0,l})}function vs(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)l.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(l.morphTargetInfluences.length===t.length){l.morphTargetDictionary={};for(let s=0,n=t.length;s<n;s++)l.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Os(l){let e;const t=l.extensions&&l.extensions[y.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Me(t.attributes):e=l.indices+":"+Me(l.attributes)+":"+l.mode,l.targets!==void 0)for(let s=0,n=l.targets.length;s<n;s++)e+=":"+Me(l.targets[s]);return e}function Me(l){let e="";const t=Object.keys(l).sort();for(let s=0,n=t.length;s<n;s++)e+=t[s]+":"+l[t[s]]+";";return e}function Be(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ps(l){return l.search(/\.jpe?g($|\?)/i)>0||l.search(/^data\:image\/jpeg/)===0?"image/jpeg":l.search(/\.webp($|\?)/i)>0||l.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Ds=new fe;class Fs{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new os,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=-1,o=!1,i=-1;if(typeof navigator<"u"){const a=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(a)===!0;const r=a.match(/Version\/(\d+)/);n=s&&r?parseInt(r[1],10):-1,o=a.indexOf("Firefox")>-1,i=o?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&n<17||o&&i<98?this.textureLoader=new st(this.options.manager):this.textureLoader=new Rt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new et(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(i){const a={scene:i[0][n.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:n.asset,parser:s,userData:{}};return X(o,a,n),D(a,n),Promise.all(s._invokeAll(function(r){return r.afterRoot&&r.afterRoot(a)})).then(function(){for(const r of a.scenes)r.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,o=t.length;n<o;n++){const i=t[n].joints;for(let a=0,r=i.length;a<r;a++)e[i[a]].isBone=!0}for(let n=0,o=e.length;n<o;n++){const i=e[n];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(s[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),o=(i,a)=>{const r=this.associations.get(i);r!=null&&this.associations.set(a,r);for(const[c,d]of i.children.entries())o(d,a.children[c])};return o(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const o=e(t[n]);o&&s.push(o)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":n=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(o,i){return s.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[y.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(o,i){s.load(oe.resolveURL(t.uri,n.path),o,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const n=t.byteLength||0,o=t.byteOffset||0;return s.slice(o,o+n)})}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const i=Re[n.type],a=Z[n.componentType],r=n.normalized===!0,c=new a(n.count*i);return Promise.resolve(new be(c,i,r))}const o=[];return n.bufferView!==void 0?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),n.sparse!==void 0&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then(function(i){const a=i[0],r=Re[n.type],c=Z[n.componentType],d=c.BYTES_PER_ELEMENT,h=d*r,u=n.byteOffset||0,m=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,g=n.normalized===!0;let A,f;if(m&&m!==h){const w=Math.floor(u/m),E="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+w+":"+n.count;let M=t.cache.get(E);M||(A=new c(a,w*m,n.count*m/d),M=new St(A,m/d),t.cache.add(E,M)),f=new Xt(M,r,u%m/d,g)}else a===null?A=new c(n.count*r):A=new c(a,u,n.count*r),f=new be(A,r,g);if(n.sparse!==void 0){const w=Re.SCALAR,E=Z[n.sparse.indices.componentType],M=n.sparse.indices.byteOffset||0,T=n.sparse.values.byteOffset||0,O=new E(i[1],M,n.sparse.count*w),G=new c(i[2],T,n.sparse.count*r);a!==null&&(f=new be(f.array.slice(),f.itemSize,f.normalized)),f.normalized=!1;for(let _=0,te=O.length;_<te;_++){const H=O[_];if(f.setX(H,G[_*r]),r>=2&&f.setY(H,G[_*r+1]),r>=3&&f.setZ(H,G[_*r+2]),r>=4&&f.setW(H,G[_*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}f.normalized=g}return f})}loadTexture(e){const t=this.json,s=this.options,o=t.textures[e].source,i=t.images[o];let a=this.textureLoader;if(i.uri){const r=s.manager.getHandler(i.uri);r!==null&&(a=r)}return this.loadTextureImage(e,o,a)}loadTextureImage(e,t,s){const n=this,o=this.json,i=o.textures[e],a=o.images[t],r=(a.uri||a.bufferView)+":"+i.sampler;if(this.textureCache[r])return this.textureCache[r];const c=this.loadImageSource(t,s).then(function(d){d.flipY=!1,d.name=i.name||a.name||"",d.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(d.name=a.uri);const u=(o.samplers||{})[i.sampler]||{};return d.magFilter=Xe[u.magFilter]||nt,d.minFilter=Xe[u.minFilter]||it,d.wrapS=qe[u.wrapS]||q,d.wrapT=qe[u.wrapT]||q,n.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[r]=c,c}loadImageSource(e,t){const s=this,n=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const i=n.images[e],a=self.URL||self.webkitURL;let r=i.uri||"",c=!1;if(i.bufferView!==void 0)r=s.getDependency("bufferView",i.bufferView).then(function(h){c=!0;const u=new Blob([h],{type:i.mimeType});return r=a.createObjectURL(u),r});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(r).then(function(h){return new Promise(function(u,m){let g=u;t.isImageBitmapLoader===!0&&(g=function(A){const f=new He(A);f.needsUpdate=!0,u(f)}),t.load(oe.resolveURL(h,o.path),g,void 0,m)})}).then(function(h){return c===!0&&a.revokeObjectURL(r),D(h,i),h.userData.mimeType=i.mimeType||Ps(i.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",r),h});return this.sourceCache[e]=d,d}assignTexture(e,t,s,n){const o=this;return this.getDependency("texture",s.index).then(function(i){if(!i)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(i=i.clone(),i.channel=s.texCoord),o.extensions[y.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[y.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const r=o.associations.get(i);i=o.extensions[y.KHR_TEXTURE_TRANSFORM].extendTexture(i,a),o.associations.set(i,r)}}return n!==void 0&&(i.colorSpace=n),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let r=this.cache.get(a);r||(r=new Mt,Ee.prototype.copy.call(r,s),r.color.copy(s.color),r.map=s.map,r.sizeAttenuation=!1,this.cache.add(a,r)),s=r}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let r=this.cache.get(a);r||(r=new Ct,Ee.prototype.copy.call(r,s),r.color.copy(s.color),r.map=s.map,this.cache.add(a,r)),s=r}if(n||o||i){let a="ClonedMaterial:"+s.uuid+":";n&&(a+="derivative-tangents:"),o&&(a+="vertex-colors:"),i&&(a+="flat-shading:");let r=this.cache.get(a);r||(r=s.clone(),o&&(r.vertexColors=!0),i&&(r.flatShading=!0),n&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(a,r),this.associations.set(r,this.associations.get(s))),s=r}e.material=s}getMaterialType(){return W}loadMaterial(e){const t=this,s=this.json,n=this.extensions,o=s.materials[e];let i;const a={},r=o.extensions||{},c=[];if(r[y.KHR_MATERIALS_UNLIT]){const h=n[y.KHR_MATERIALS_UNLIT];i=h.getMaterialType(),c.push(h.extendParams(a,o,t))}else{const h=o.pbrMetallicRoughness||{};if(a.color=new $(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const u=h.baseColorFactor;a.color.setRGB(u[0],u[1],u[2],N),a.opacity=u[3]}h.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",h.baseColorTexture,re)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),i=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,a)})))}o.doubleSided===!0&&(a.side=ot);const d=o.alphaMode||Se.OPAQUE;if(d===Se.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===Se.MASK&&(a.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&i!==ne&&(c.push(t.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new De(1,1),o.normalTexture.scale!==void 0)){const h=o.normalTexture.scale;a.normalScale.set(h,h)}if(o.occlusionTexture!==void 0&&i!==ne&&(c.push(t.assignTexture(a,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&i!==ne){const h=o.emissiveFactor;a.emissive=new $().setRGB(h[0],h[1],h[2],N)}return o.emissiveTexture!==void 0&&i!==ne&&c.push(t.assignTexture(a,"emissiveMap",o.emissiveTexture,re)),Promise.all(c).then(function(){const h=new i(a);return o.name&&(h.name=o.name),D(h,o),t.associations.set(h,{materials:e}),o.extensions&&X(n,h,o),h})}createUniqueName(e){const t=kt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function o(a){return s[y.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(r){return Ye(r,a,t)})}const i=[];for(let a=0,r=e.length;a<r;a++){const c=e[a],d=Os(c),h=n[d];if(h)i.push(h.promise);else{let u;c.extensions&&c.extensions[y.KHR_DRACO_MESH_COMPRESSION]?u=o(c):u=Ye(new Lt,c,t),n[d]={primitive:c,promise:u},i.push(u)}}return Promise.all(i)}loadMesh(e){const t=this,s=this.json,n=this.extensions,o=s.meshes[e],i=o.primitives,a=[];for(let r=0,c=i.length;r<c;r++){const d=i[r].material===void 0?_s(this.cache):this.getDependency("material",i[r].material);a.push(d)}return a.push(t.loadGeometries(i)),Promise.all(a).then(function(r){const c=r.slice(0,r.length-1),d=r[r.length-1],h=[];for(let m=0,g=d.length;m<g;m++){const A=d[m],f=i[m];let w;const E=c[m];if(f.mode===I.TRIANGLES||f.mode===I.TRIANGLE_STRIP||f.mode===I.TRIANGLE_FAN||f.mode===void 0)w=o.isSkinnedMesh===!0?new It(A,E):new z(A,E),w.isSkinnedMesh===!0&&w.normalizeSkinWeights(),f.mode===I.TRIANGLE_STRIP?w.geometry=We(w.geometry,Je):f.mode===I.TRIANGLE_FAN&&(w.geometry=We(w.geometry,Ce));else if(f.mode===I.LINES)w=new _t(A,E);else if(f.mode===I.LINE_STRIP)w=new Bt(A,E);else if(f.mode===I.LINE_LOOP)w=new vt(A,E);else if(f.mode===I.POINTS)w=new Ot(A,E);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);Object.keys(w.geometry.morphAttributes).length>0&&vs(w,o),w.name=t.createUniqueName(o.name||"mesh_"+e),D(w,o),f.extensions&&X(n,w,f),t.assignFinalMaterial(w),h.push(w)}for(let m=0,g=h.length;m<g;m++)t.associations.set(h[m],{meshes:e,primitives:m});if(h.length===1)return o.extensions&&X(n,h[0],o),h[0];const u=new B;o.extensions&&X(n,u,o),t.associations.set(u,{meshes:e});for(let m=0,g=h.length;m<g;m++)u.add(h[m]);return u})}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new rt(Pt.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(t=new Dt(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),D(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let n=0,o=t.joints.length;n<o;n++)s.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(n){const o=n.pop(),i=n,a=[],r=[];for(let c=0,d=i.length;c<d;c++){const h=i[c];if(h){a.push(h);const u=new fe;o!==null&&u.fromArray(o.array,c*16),r.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Ft(a,r)})}loadAnimation(e){const t=this.json,s=this,n=t.animations[e],o=n.name?n.name:"animation_"+e,i=[],a=[],r=[],c=[],d=[];for(let h=0,u=n.channels.length;h<u;h++){const m=n.channels[h],g=n.samplers[m.sampler],A=m.target,f=A.node,w=n.parameters!==void 0?n.parameters[g.input]:g.input,E=n.parameters!==void 0?n.parameters[g.output]:g.output;A.node!==void 0&&(i.push(this.getDependency("node",f)),a.push(this.getDependency("accessor",w)),r.push(this.getDependency("accessor",E)),c.push(g),d.push(A))}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(r),Promise.all(c),Promise.all(d)]).then(function(h){const u=h[0],m=h[1],g=h[2],A=h[3],f=h[4],w=[];for(let E=0,M=u.length;E<M;E++){const T=u[E],O=m[E],G=g[E],_=A[E],te=f[E];if(T===void 0)continue;T.updateMatrix&&T.updateMatrix();const H=s._createAnimationTracks(T,O,G,_,te);if(H)for(let Te=0;Te<H.length;Te++)w.push(H[Te])}return new Le(o,void 0,w)})}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(o){const i=s._getNodeRef(s.meshCache,n.mesh,o);return n.weights!==void 0&&i.traverse(function(a){if(a.isMesh)for(let r=0,c=n.weights.length;r<c;r++)a.morphTargetInfluences[r]=n.weights[r]}),i})}loadNode(e){const t=this.json,s=this,n=t.nodes[e],o=s._loadNodeShallow(e),i=[],a=n.children||[];for(let c=0,d=a.length;c<d;c++)i.push(s.getDependency("node",a[c]));const r=n.skin===void 0?Promise.resolve(null):s.getDependency("skin",n.skin);return Promise.all([o,Promise.all(i),r]).then(function(c){const d=c[0],h=c[1],u=c[2];u!==null&&d.traverse(function(m){m.isSkinnedMesh&&m.bind(u,Ds)});for(let m=0,g=h.length;m<g;m++)d.add(h[m]);return d})}_loadNodeShallow(e){const t=this.json,s=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],i=o.name?n.createUniqueName(o.name):"",a=[],r=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return r&&a.push(r),o.camera!==void 0&&a.push(n.getDependency("camera",o.camera).then(function(c){return n._getNodeRef(n.cameraCache,o.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let d;if(o.isBone===!0?d=new Nt:c.length>1?d=new B:c.length===1?d=c[0]:d=new xe,d!==c[0])for(let h=0,u=c.length;h<u;h++)d.add(c[h]);if(o.name&&(d.userData.name=o.name,d.name=i),D(d,o),o.extensions&&X(s,d,o),o.matrix!==void 0){const h=new fe;h.fromArray(o.matrix),d.applyMatrix4(h)}else o.translation!==void 0&&d.position.fromArray(o.translation),o.rotation!==void 0&&d.quaternion.fromArray(o.rotation),o.scale!==void 0&&d.scale.fromArray(o.scale);return n.associations.has(d)||n.associations.set(d,{}),n.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],n=this,o=new B;s.name&&(o.name=n.createUniqueName(s.name)),D(o,s),s.extensions&&X(t,o,s);const i=s.nodes||[],a=[];for(let r=0,c=i.length;r<c;r++)a.push(n.getDependency("node",i[r]));return Promise.all(a).then(function(r){for(let d=0,h=r.length;d<h;d++)o.add(r[d]);const c=d=>{const h=new Map;for(const[u,m]of n.associations)(u instanceof Ee||u instanceof He)&&h.set(u,m);return d.traverse(u=>{const m=n.associations.get(u);m!=null&&h.set(u,m)}),h};return n.associations=c(o),o})}_createAnimationTracks(e,t,s,n,o){const i=[],a=e.name?e.name:e.uuid,r=[];j[o.path]===j.weights?e.traverse(function(u){u.morphTargetInfluences&&r.push(u.name?u.name:u.uuid)}):r.push(a);let c;switch(j[o.path]){case j.weights:c=Ke;break;case j.rotation:c=Ue;break;case j.position:case j.scale:c=je;break;default:switch(s.itemSize){case 1:c=Ke;break;case 2:case 3:default:c=je;break}break}const d=n.interpolation!==void 0?Is[n.interpolation]:at,h=this._getArrayFromAccessor(s);for(let u=0,m=r.length;u<m;u++){const g=new c(r[u]+"."+j[o.path],t.array,h,d);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),i.push(g)}return i}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const s=Be(t.constructor),n=new Float32Array(t.length);for(let o=0,i=t.length;o<i;o++)n[o]=t[o]*s;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const n=this instanceof Ue?Ls:dt;return new n(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ns(l,e,t){const s=e.attributes,n=new C;if(s.POSITION!==void 0){const a=t.json.accessors[s.POSITION],r=a.min,c=a.max;if(r!==void 0&&c!==void 0){if(n.set(new x(r[0],r[1],r[2]),new x(c[0],c[1],c[2])),a.normalized){const d=Be(Z[a.componentType]);n.min.multiplyScalar(d),n.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const a=new x,r=new x;for(let c=0,d=o.length;c<d;c++){const h=o[c];if(h.POSITION!==void 0){const u=t.json.accessors[h.POSITION],m=u.min,g=u.max;if(m!==void 0&&g!==void 0){if(r.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),r.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),r.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),u.normalized){const A=Be(Z[u.componentType]);r.multiplyScalar(A)}a.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}l.boundingBox=n;const i=new qt;n.getCenter(i.center),i.radius=n.min.distanceTo(n.max)/2,l.boundingSphere=i}function Ye(l,e,t){const s=e.attributes,n=[];function o(i,a){return t.getDependency("accessor",i).then(function(r){l.setAttribute(a,r)})}for(const i in s){const a=_e[i]||i.toLowerCase();a in l.attributes||n.push(o(s[i],a))}if(e.indices!==void 0&&!l.index){const i=t.getDependency("accessor",e.indices).then(function(a){l.setIndex(a)});n.push(i)}return Ge.workingColorSpace!==N&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ge.workingColorSpace}" not supported.`),D(l,e),Ns(l,e,t),Promise.all(n).then(function(){return e.targets!==void 0?Bs(l,e.targets,t):l})}class b{constructor(e,t,s,n=0,o=20){this.wallHeight=5,this.wallWidth=.2,this.wallDepth=o,this.lights=[],this.lightMeshes=[],this.loader=new st,this.texture=this.loader.load("/wall-textures/concrete_wall_003_diff_1k.jpg",i=>{i.wrapS=i.wrapT=q,i.repeat.set(3,1),i.encoding=void 0,i.anisotropy=16}),this.roughnessTexture=this.loader.load("/wall-textures/concrete_wall_003_rough_1k.jpg",i=>{i.wrapS=i.wrapT=q,i.repeat.set(5,5)}),this.normalTexture=this.loader.load("/wall-textures/concrete_wall_003_nor_gl_1k.exr",i=>{i.wrapS=i.wrapT=q,i.repeat.set(5,5)}),this.aoTexture=this.loader.load("/wall-textures/concrete_wall_003_ao_1k.jpg",i=>{i.wrapS=i.wrapT=q,i.repeat.set(5,5)}),this.geometry=new ge(this.wallWidth,this.wallHeight,this.wallDepth,2,10,20),this.material=new W({map:this.texture,normalMap:this.normalTexture,normalScale:new De(1,1),roughnessMap:this.roughnessTexture,roughness:.7,metalness:.1,aoMap:this.aoTexture,aoMapIntensity:1,side:ot}),this.mesh=new z(this.geometry,this.material),this.mesh.rotation.y=n,this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.position.set(e,t+this.wallHeight/2,s),this.createWallLights(),this.boundingBox=new C().setFromObject(this.mesh),this.geometry.attributes.uv&&this.geometry.setAttribute("uv2",this.geometry.attributes.uv)}createWallLights(){const e=new ge(.3,.3,.2),t=new W({color:8421504,metalness:.8,roughness:.2}),s=new $t(.5,.5,.5,8),n=new v({color:16777215,metalness:0,roughness:.1,transparent:!0,opacity:.7,transmission:.5});[{height:this.wallHeight*.2,depth:this.wallDepth*.25},{height:this.wallHeight*.2,depth:this.wallDepth*.75}].forEach(i=>{const a=new z(e,t);a.castShadow=!0,a.receiveShadow=!0;const r=new z(s,n);r.rotation.x=Math.PI/2,r.position.z=.1,a.add(r);const c=this.mesh.rotation.y,d=this.wallWidth/2+.1;a.position.set(this.mesh.position.x+Math.sin(c)*d,this.mesh.position.y-this.wallHeight/2+i.height,this.mesh.position.z+Math.cos(c)*d),a.position.z+=Math.cos(c)*(i.depth-this.wallDepth/2),a.position.x+=Math.sin(c)*(i.depth-this.wallDepth/2),a.rotation.y=c;const h=new ke(16765582,.8,5);h.castShadow=!0,h.shadow.mapSize.width=512,h.shadow.mapSize.height=512,h.shadow.camera.near=.1,h.shadow.camera.far=10,h.position.copy(a.position),h.position.z+=Math.cos(c)*.2,h.position.x+=Math.sin(c)*.2;const u=new ke(16765582,.2,2);u.position.copy(h.position),this.lights.push(h,u),this.lightMeshes.push(a)})}addToScene(e){e.add(this.mesh),this.lights.forEach(t=>e.add(t)),this.lightMeshes.forEach(t=>e.add(t))}removeFromScene(e){e.remove(this.mesh),this.lights.forEach(t=>e.remove(t)),this.lightMeshes.forEach(t=>e.remove(t))}animateLights(e){this.lights.forEach((t,s)=>{if(s%2===0){const n=.95+.05*Math.sin(e*10+s);t.intensity=.8*n}})}setLightColor(e){this.lights.forEach(t=>{t.color.set(e)})}setLightIntensity(e){this.lights.forEach((t,s)=>{s%2===0?t.intensity=e:t.intensity=e*.25})}updateBoundingBox(){this.boundingBox.setFromObject(this.mesh)}dispose(){this.geometry.dispose(),this.material.dispose(),this.texture.dispose(),this.roughnessTexture.dispose(),this.normalTexture.dispose(),this.aoTexture.dispose(),this.lightMeshes.forEach(e=>{e.geometry.dispose(),e.material.dispose(),e.children.forEach(t=>{t.geometry.dispose(),t.material.dispose()})})}}let Gs=class{constructor(e,t){this.scene=e,this.player=t,this.offset=new b(0,0,0,0,0).wallWidth/2,this.objects=[],this.wallBoundingBoxes=[];const s=new ee;let n;this.monstersDead=!1;let o=this.monstersDead?"unlocked.glb":"scene.gltf";console.log("Player:::: ",this.player),s.load(`/science_lab_door_-_apocalyptic/${o}`,r=>{n=r.scene,n.scale.set(2,1.5,1),n.position.set(-23.83,1.6,-24.9),this.scene.add(n)},void 0,r=>{console.error("Error loading the GLTF model:",r)}),this.roomGroup=new B;const i=.001;this.wall=new b(25,0,0,0,50),this.roomGroup.add(this.wall.mesh),this.addBoundingBox(this.wall.mesh),this.wall2=new b(-25,0,0,0,50),this.roomGroup.add(this.wall2.mesh),this.addBoundingBox(this.wall2.mesh),this.wall3=new b(1.5,0,-25,Math.PI/2,48.9),this.roomGroup.add(this.wall3.mesh),this.addBoundingBox(this.wall3.mesh),this.wallTop=new b(-24,3,-25,Math.PI/2,2.2),this.roomGroup.add(this.wallTop.mesh),this.addBoundingBox(this.wallTop.mesh),this.wall4=new b(0,0,25,Math.PI/2,50),this.roomGroup.add(this.wall4.mesh),this.addBoundingBox(this.wall4.mesh),this.scene.add(this.roomGroup),this.bedroomGroup=new B,this.bedroomWall1=new b(-10,0,20,0,10),this.bedroomGroup.add(this.bedroomWall1.mesh),this.addBoundingBox(this.bedroomWall1.mesh),this.bedroomWall2=new b(-16.5+this.offset-i,0,15+this.offset-i,Math.PI/2,13),this.bedroomGroup.add(this.bedroomWall2.mesh),this.addBoundingBox(this.bedroomWall2.mesh),this.scene.add(this.bedroomGroup),this.enemyRoomGroup=new B;let a;s.load("/prison_cell_door/scene.gltf",r=>{a=r.scene,a.scale.set(2,1.5,1),a.position.set(2.2,0,14.95),this.enemyRoomGroup.add(a);let c=a.clone();c.position.set(18.2,0,14.95),this.enemyRoomGroup.add(c),this.enemyRoomWall1=new b(-5,0,20,0,10),this.enemyRoomGroup.add(this.enemyRoomWall1.mesh),this.enemyRoomWall2=new b(10-this.offset+i,0,15-this.offset-i,Math.PI/2,13),this.enemyRoomGroup.add(this.enemyRoomWall2.mesh),this.enemyRoomWall3=new b(10,0,20,0,10),this.enemyRoomGroup.add(this.enemyRoomWall3.mesh),this.enemyRoomWall4=new b(-2.5-this.offset+i,0,15-this.offset-i,Math.PI/2,5),this.enemyRoomGroup.add(this.enemyRoomWall4.mesh),this.enemyRoomWall5=new b(22.5-this.offset+i,0,15-this.offset-i,Math.PI/2,5),this.enemyRoomGroup.add(this.enemyRoomWall5.mesh),this.scene.add(this.enemyRoomGroup),this.addBoundingBox(this.enemyRoomGroup),this.anotherRoomGroup=this.enemyRoomGroup.clone(),this.anotherRoomGroup.rotation.set(0,Math.PI/2,0),this.addBoundingBox(this.anotherRoomGroup),this.scene.add(this.anotherRoomGroup)},void 0,r=>{console.error("Error loading the GLTF model:",r)}),this.labGroup=new B,this.labWall1=new b(10,0,-17.5,0,15),this.labGroup.add(this.labWall1.mesh),this.addBoundingBox(this.labWall1.mesh),this.labWall2=new b(10,0,2,0,16),this.labGroup.add(this.labWall2.mesh),this.addBoundingBox(this.labWall2.mesh),this.labWall3=new b(-7.5,0,10,Math.PI/2,35),this.labGroup.add(this.labWall3.mesh),this.addBoundingBox(this.labWall3.mesh),this.scene.add(this.labGroup)}addBoundingBox(e){const t=new C().setFromObject(e);this.wallBoundingBoxes.push(t)}getWallBoundingBoxes(){return this.wallBoundingBoxes}setMonstersDead(){this.monstersDead=!0}clearScene(){this.scene.remove(this.labGroup),this.scene.remove(this.anotherRoomGroup),this.scene.remove(this.enemyRoomGroup),this.scene.remove(this.bedroomGroup)}};class Hs{constructor(e,t){this.scene=e,this.player=t,this.offset=new b(0,0,0,0,0).wallWidth/2,this.wallBoundingBoxes=[];const s=new ee;let n;this.monstersDead=!1;let o=this.monstersDead?"unlocked.glb":"scene.gltf";this.player.position.set(-20.83,0,22.9),console.log("Player:::: ",this.player),s.load(`/science_lab_door_-_apocalyptic/${o}`,r=>{n=r.scene,n.scale.set(2,1.5,1),n.position.set(-23.83,1.6,-24.9),this.scene.add(n)},void 0,r=>{console.error("Error loading the GLTF model:",r)}),this.roomGroup=new B;const i=.001;this.wall=new b(25,0,0,0,50),this.roomGroup.add(this.wall.mesh),this.addBoundingBox(this.wall.mesh),this.wall2=new b(-25,0,0,0,50),this.roomGroup.add(this.wall2.mesh),this.addBoundingBox(this.wall2.mesh),this.wall3=new b(1.5,0,-25,Math.PI/2,48.9),this.roomGroup.add(this.wall3.mesh),this.addBoundingBox(this.wall3.mesh),this.wallTop=new b(-24,3,-25,Math.PI/2,2.2),this.roomGroup.add(this.wallTop.mesh),this.addBoundingBox(this.wallTop.mesh),this.wall4=new b(0,0,25,Math.PI/2,50),this.roomGroup.add(this.wall4.mesh),this.addBoundingBox(this.wall4.mesh),this.scene.add(this.roomGroup),this.bedroomGroup=new B,this.bedroomWall1=new b(-10,0,20,0,10),this.bedroomGroup.add(this.bedroomWall1.mesh),this.addBoundingBox(this.bedroomWall1.mesh),this.bedroomWall2=new b(-16.5+this.offset-i,0,15+this.offset-i,Math.PI/2,13),this.bedroomGroup.add(this.bedroomWall2.mesh),this.addBoundingBox(this.bedroomWall2.mesh),this.scene.add(this.bedroomGroup),this.enemyRoomGroup=new B;let a;s.load("/prison_cell_door/scene.gltf",r=>{a=r.scene,a.scale.set(2,1.5,1),a.position.set(2.2,0,14.95),this.enemyRoomGroup.add(a);let c=a.clone();c.position.set(18.2,0,14.95),this.enemyRoomGroup.add(c),this.enemyRoomWall1=new b(-5,0,20,0,10),this.enemyRoomGroup.add(this.enemyRoomWall1.mesh),this.enemyRoomWall2=new b(10-this.offset+i,0,15-this.offset-i,Math.PI/2,13),this.enemyRoomGroup.add(this.enemyRoomWall2.mesh),this.enemyRoomWall3=new b(10,0,20,0,10),this.enemyRoomGroup.add(this.enemyRoomWall3.mesh),this.enemyRoomWall4=new b(-2.5-this.offset+i,0,15-this.offset-i,Math.PI/2,5),this.enemyRoomGroup.add(this.enemyRoomWall4.mesh),this.enemyRoomWall5=new b(22.5-this.offset+i,0,15-this.offset-i,Math.PI/2,5),this.enemyRoomGroup.add(this.enemyRoomWall5.mesh),this.scene.add(this.enemyRoomGroup),this.addBoundingBox(this.enemyRoomGroup),this.anotherRoomGroup=this.enemyRoomGroup.clone(),this.anotherRoomGroup.rotation.set(0,Math.PI/2,0),this.addBoundingBox(this.anotherRoomGroup),this.scene.add(this.anotherRoomGroup)},void 0,r=>{console.error("Error loading the GLTF model:",r)})}addBoundingBox(e){const t=new C().setFromObject(e);this.wallBoundingBoxes.push(t)}getWallBoundingBoxes(){return this.wallBoundingBoxes}setMonstersDead(){this.monstersDead=!0}}class js{constructor(e){this.scene=e,this.ghosts=[],this.loader=new ee,this.targetPosition=new x(0,0,0),this.spawnInterval=null,this.boundingBox={minX:-100,maxX:100,minZ:-100,maxZ:100},this.hitSound=new Audio("/shot.mp3"),this.deathSound=new Audio("/die.mp3")}setTarget(e){this.targetPosition=e}getTargetPosition(){return this.targetPosition instanceof xe?this.targetPosition.position:this.targetPosition}getRandomPosition(){return[Math.random()*(this.boundingBox.maxX-this.boundingBox.minX)+this.boundingBox.minX,5,Math.random()*(this.boundingBox.maxZ-this.boundingBox.minZ)+this.boundingBox.minZ]}createGhost(e){this.loader.load("./scp-096_original/scene.gltf",t=>{const s=t.scene,n={model:s,mixer:new lt(s),animations:t.animations,hitCount:0,health:100,isHit:!1,isDying:!1};s.position.set(e[0],0,e[2]),s.scale.set(1.1,1.1,1.1),s.rotation.set(0,Math.random()*Math.PI*2,0),s.traverse(o=>{o.isMesh&&(o.castShadow=!0,o.receiveShadow=!0)}),this.scene.add(s),t.animations&&t.animations.length>0&&n.mixer.clipAction(t.animations[5]).play(),this.ghosts.push(n)},t=>{console.log(t.loaded/t.total*100+"% loaded")},t=>{console.error("An error happened while loading the ghost model:",t)})}playHitAnimation(e){if(!e.mixer||!e.animations||e.isDying)return;e.isHit=!0,e.health-=34,this.hitSound.currentTime=0,this.hitSound.play().catch(s=>console.log("Error playing hit sound:",s)),e.mixer.stopAllAction();const t=e.mixer.clipAction(e.animations[4]);if(console.log(e.animations),t.setLoop(Ie),t.clampWhenFinished=!0,t.reset().play(),e.health<=0){this.playDeathAnimation(e);return}setTimeout(()=>{e.isHit=!1,e.mixer.stopAllAction(),e.mixer.clipAction(e.animations[5]).reset().play()},1e3)}playDeathAnimation(e){if(!e.mixer||!e.animations||e.isDying)return;e.isDying=!0,this.deathSound.currentTime=0,this.deathSound.play().catch(s=>console.log("Error playing death sound:",s)),e.mixer.stopAllAction();const t=e.mixer.clipAction(e.animations[1]);t.setLoop(Ie),t.clampWhenFinished=!0,t.reset().play(),setTimeout(()=>{const s=this.ghosts.findIndex(n=>n===e);s!==-1&&this.removeGhost(s)},2e3)}moveGhosts(e){const t=this.getTargetPosition();this.ghosts.forEach(s=>{if(!s.model||!s.mixer||s.isHit||s.isDying){s.mixer&&s.mixer.update(e);return}const n=s.model.position;n.distanceTo(t);const o=.03,i=new x().subVectors(t,n).normalize();if(s.model.position.add(i.multiplyScalar(o)),s.model.lookAt(t.x,n.y,t.z),s.mixer.update(e),s.animations&&s.animations.length>0){const a=s.mixer.clipAction(s.animations[5]);a.isRunning()||a.reset().play()}})}startSpawning(e=5e3,t=10){this.stopSpawning(),this.spawnInterval=setInterval(()=>{if(this.ghosts.length<t){const s=this.getRandomPosition();this.createGhost(s)}},e)}stopSpawning(){this.spawnInterval&&(clearInterval(this.spawnInterval),this.spawnInterval=null)}removeGhost(e){const t=this.ghosts[e];t&&t.model&&(this.scene.remove(t.model),t.mixer&&t.mixer.stopAllAction(),this.ghosts.splice(e,1))}removeAllGhosts(){[...this.ghosts].forEach((e,t)=>{this.removeGhost(t)}),this.ghosts=[]}getActiveGhosts(){return this.ghosts.filter(e=>!e.isDying)}handleBulletCollision(e,t,s,n){for(let o=0;o<this.ghosts.length;o++){const i=this.ghosts[o];if(!i.model||i.isDying)continue;const a=new C().setFromObject(i.model),r=new C().setFromObject(e);if(a.intersectsBox(r))return n.remove(e),s.splice(t,1),this.playHitAnimation(i),!0}return!1}}function Ks(l){return new js(l)}function Us(l,e){l.moveGhosts(e)}class zs{constructor(e,t,s={}){this.maxHealth=e,this.currentHealth=t,this.options={position:{top:"20px",left:"20px"},width:"200px",barHeight:"20px",backgroundColor:"rgba(0, 0, 0, 0.5)",barColors:{high:"#44ff44",medium:"#ffaa44",low:"#ff4444"},...s},this.initialize()}initialize(){this.container=document.createElement("div"),this.container.style.position="fixed",this.container.style.top=this.options.position.top,this.container.style.left=this.options.position.left,this.container.style.padding="10px",this.container.style.backgroundColor=this.options.backgroundColor,this.container.style.color="white",this.container.style.fontFamily="Arial, sans-serif",this.container.style.borderRadius="5px",this.container.style.minWidth=this.options.width,this.healthText=document.createElement("div"),this.healthText.style.textAlign="center",this.healthText.style.marginBottom="5px",this.progressContainer=document.createElement("div"),this.progressContainer.style.width="100%",this.progressContainer.style.height=this.options.barHeight,this.progressContainer.style.backgroundColor="#333",this.progressContainer.style.borderRadius="10px",this.progressContainer.style.overflow="hidden",this.progressContainer.style.marginTop="5px",this.progressBar=document.createElement("div"),this.progressBar.style.height="100%",this.progressBar.style.width="100%",this.progressBar.style.transition="width 0.3s ease-in-out",this.progressContainer.appendChild(this.progressBar),this.container.appendChild(this.healthText),this.container.appendChild(this.progressContainer),this.updateDisplay()}mount(e=document.body){e.appendChild(this.container)}unmount(){this.container.remove()}updateDisplay(){const e=Math.floor(this.currentHealth/this.maxHealth*100);this.healthText.textContent=`Health: ${this.currentHealth}/${this.maxHealth}`,this.progressBar.style.width=`${e}%`,e<25?this.progressBar.style.backgroundColor=this.options.barColors.low:e<50?this.progressBar.style.backgroundColor=this.options.barColors.medium:this.progressBar.style.backgroundColor=this.options.barColors.high}addHealth(e){this.currentHealth=Math.min(this.currentHealth+e,this.maxHealth),this.updateDisplay()}damage(e){this.currentHealth=Math.max(0,this.currentHealth-e),this.updateDisplay(),this.currentHealth<=0&&this.onGameOver()}setHealth(e){this.currentHealth=Math.max(0,Math.min(e,this.maxHealth)),this.updateDisplay()}onGameOver(){console.log("Game Over!")}}class Ws{constructor(e,t,s={}){this.maxAmmo=e,this.currentAmmo=t,this.isReloading=!1,this.options={position:{top:"60px",right:"20px"},width:"200px",barHeight:"20px",backgroundColor:"rgba(0, 0, 0, 0.5)",barColors:{full:"#ffcc00",medium:"#ff9900",low:"#ff4444",reloading:"#3498db"},reloadTime:2e3,showProgressBar:!0,...s},this.initialize()}initialize(){this.container=document.createElement("div"),this.container.style.position="fixed",this.container.style.bottom=this.options.position.top,this.container.style.left=this.options.position.left,this.container.style.padding="10px",this.container.style.backgroundColor=this.options.backgroundColor,this.container.style.color="white",this.container.style.fontFamily="Arial, sans-serif",this.container.style.borderRadius="5px",this.container.style.minWidth=this.options.width,this.ammoText=document.createElement("div"),this.ammoText.style.textAlign="center",this.ammoText.style.marginBottom="5px",this.options.showProgressBar&&(this.progressContainer=document.createElement("div"),this.progressContainer.style.width="100%",this.progressContainer.style.height=this.options.barHeight,this.progressContainer.style.backgroundColor="#333",this.progressContainer.style.borderRadius="10px",this.progressContainer.style.overflow="hidden",this.progressContainer.style.marginTop="5px",this.progressBar=document.createElement("div"),this.progressBar.style.height="100%",this.progressBar.style.width="100%",this.progressBar.style.transition="width 0.3s ease-in-out",this.progressContainer.appendChild(this.progressBar)),this.reloadIndicator=document.createElement("div"),this.reloadIndicator.style.textAlign="center",this.reloadIndicator.style.fontSize="0.8em",this.reloadIndicator.style.marginTop="5px",this.reloadIndicator.style.opacity="0",this.reloadIndicator.style.transition="opacity 0.3s ease-in-out",this.container.appendChild(this.ammoText),this.options.showProgressBar&&this.container.appendChild(this.progressContainer),this.container.appendChild(this.reloadIndicator),this.updateDisplay()}mount(e=document.body){e.appendChild(this.container)}unmount(){this.container.remove()}updateDisplay(){const e=this.currentAmmo/this.maxAmmo*100;this.ammoText.textContent=`Ammo: ${this.currentAmmo}/${this.maxAmmo}`,this.options.showProgressBar&&(this.progressBar.style.width=`${e}%`,this.isReloading?this.progressBar.style.backgroundColor=this.options.barColors.reloading:e<25?this.progressBar.style.backgroundColor=this.options.barColors.low:e<50?this.progressBar.style.backgroundColor=this.options.barColors.medium:this.progressBar.style.backgroundColor=this.options.barColors.full)}useAmmo(e=1){return this.isReloading?!1:this.currentAmmo>=e?(this.currentAmmo-=e,this.updateDisplay(),!0):!1}reload(){if(!(this.isReloading||this.currentAmmo===this.maxAmmo))return this.isReloading=!0,this.reloadIndicator.textContent="Reloading...",this.reloadIndicator.style.opacity="1",this.updateDisplay(),new Promise(e=>{setTimeout(()=>{this.currentAmmo=this.maxAmmo,this.isReloading=!1,this.reloadIndicator.style.opacity="0",this.updateDisplay(),e()},this.options.reloadTime)})}setAmmo(e){this.currentAmmo=Math.max(0,Math.min(e,this.maxAmmo)),this.updateDisplay()}}class Vs{constructor(e,t={}){this.gameName=e,this.options={backgroundColor:"#000000",titleColor:"#ffffff",loadingColor:"#888888",dotColors:["#ff0000","#00ff00","#0000ff"],fadeTime:500,fontSize:{title:"48px",loading:"24px"},fontFamily:"Arial, sans-serif",...t},this.initialize()}initialize(){this.container=document.createElement("div"),Object.assign(this.container.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:this.options.backgroundColor,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:"0",transition:`opacity ${this.options.fadeTime}ms ease-in-out`,zIndex:"9999"}),this.title=document.createElement("h1"),Object.assign(this.title.style,{color:this.options.titleColor,fontSize:this.options.fontSize.title,fontFamily:this.options.fontFamily,margin:"0 0 20px 0",textAlign:"center",opacity:"0",transform:"translateY(20px)",transition:"opacity 0.5s ease-in-out, transform 0.5s ease-in-out"}),this.title.textContent=this.gameName,this.loadingContainer=document.createElement("h3"),Object.assign(this.loadingContainer.style,{color:this.options.loadingColor,fontSize:this.options.fontSize.loading,fontFamily:this.options.fontFamily,margin:"0",display:"flex",alignItems:"center",opacity:"0",transform:"translateY(20px)",transition:"opacity 0.5s ease-in-out, transform 0.5s ease-in-out"}),this.loadingText=document.createElement("span"),this.loadingText.textContent="Loading",this.dotsContainer=document.createElement("span"),this.dots=[];for(let e=0;e<3;e++){const t=document.createElement("span");Object.assign(t.style,{color:this.options.dotColors[e],marginLeft:"4px",opacity:"0",transition:"opacity 0.3s ease-in-out",animation:`loadingDotBounce${e} 1s infinite`}),t.textContent=".",this.dots.push(t),this.dotsContainer.appendChild(t)}this.loadingContainer.appendChild(this.loadingText),this.loadingContainer.appendChild(this.dotsContainer),this.container.appendChild(this.title),this.container.appendChild(this.loadingContainer),this.createAnimations()}createAnimations(){const e=document.createElement("style"),t=this.dots.map((s,n)=>`
            @keyframes loadingDotBounce${n} {
                0%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-10px); }
            }
        `).join(`
`);e.textContent=t,document.head.appendChild(e)}mount(e=document.body){e.appendChild(this.container),requestAnimationFrame(()=>{this.container.style.opacity="1",setTimeout(()=>{this.title.style.opacity="1",this.title.style.transform="translateY(0)",this.loadingContainer.style.opacity="1",this.loadingContainer.style.transform="translateY(0)",this.dots.forEach((t,s)=>{setTimeout(()=>{t.style.opacity="1"},s*150)})},1e3)})}unmount(){return new Promise(e=>{this.container.style.opacity="0",setTimeout(()=>{this.container.remove(),e()},this.options.fadeTime)})}setProgress(e){this.loadingText.textContent=`Loading ${Math.round(e)}%`}setMessage(e){this.loadingText.textContent=e}}class Xs{constructor(e={}){this.config={maxHealth:e.maxHealth||200,medkitHealAmount:e.medkitHealAmount||25,initialMedkits:e.initialMedkits||3,gunDamage:e.gunDamage||20,fireRate:e.fireRate||.5,...e},this.state={currentHealth:this.config.maxHealth,selectedSlot:1,lastFired:0,items:{weapon:{equipped:!0,damage:this.config.gunDamage,fireRate:this.config.fireRate},medkit:{uses:this.config.initialMedkits,healAmount:this.config.medkitHealAmount}}},this.ui={},this.initializeUI(),this.bindEvents()}createContainer(){const e=document.createElement("div");return Object.assign(e.style,{position:"fixed",bottom:"20px",right:"20px",padding:"15px",background:"rgba(0, 0, 0, 0.7)",borderRadius:"8px",color:"white",fontFamily:"Arial, sans-serif",userSelect:"none",zIndex:"1000"}),e}createHealthDisplay(){const e=document.createElement("div");return Object.assign(e.style,{marginBottom:"10px",fontSize:"16px",fontWeight:"bold"}),e.textContent=`Health: ${this.state.currentHealth}/${this.config.maxHealth}`,e}createSlot(e,t){const s=document.createElement("div");Object.assign(s.style,{width:"60px",height:"60px",border:"2px solid #666",borderRadius:"4px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",background:"rgba(40, 40, 40, 0.6)",transition:"all 0.2s ease"});const n=document.createElement("div");Object.assign(n.style,{fontSize:"24px",marginBottom:"4px"}),n.textContent=t,n.className="slot-icon";const o=document.createElement("div");return Object.assign(o.style,{fontSize:"12px"}),o.textContent=e,o.className="slot-label",s.appendChild(n),s.appendChild(o),s}createInventorySlots(){const e=document.createElement("div");return Object.assign(e.style,{display:"flex",gap:"10px"}),this.ui.gunSlot=this.createSlot("1: Gun","🔫"),this.ui.medkitSlot=this.createSlot(`2: Medkit (${this.state.items.medkit.uses})`,"❤️"),e.appendChild(this.ui.gunSlot),e.appendChild(this.ui.medkitSlot),e}createControlsHint(){const e=document.createElement("div");return Object.assign(e.style,{marginTop:"10px",fontSize:"12px",color:"#aaa",textAlign:"center"}),e.textContent="Press 1-2 to select, E to use medkit",e}initializeUI(){this.ui.container=this.createContainer(),this.ui.healthDisplay=this.createHealthDisplay(),this.ui.slots=this.createInventorySlots(),this.ui.controls=this.createControlsHint(),this.ui.container.appendChild(this.ui.healthDisplay),this.ui.container.appendChild(this.ui.slots),this.ui.container.appendChild(this.ui.controls),document.body.appendChild(this.ui.container),this.selectSlot(1)}updateUI(){this.ui.healthDisplay.textContent=`Health: ${Math.ceil(this.state.currentHealth)}/${this.config.maxHealth}`;const e=this.ui.medkitSlot.querySelector(".slot-label");e&&(e.textContent=`2: Medkit (${this.state.items.medkit.uses})`)}bindEvents(){window.addEventListener("keydown",this.handleKeyPress.bind(this)),this.ui.gunSlot.addEventListener("click",()=>this.selectSlot(1)),this.ui.medkitSlot.addEventListener("click",()=>this.selectSlot(2))}handleKeyPress(e){const t=e.key.toLowerCase();t==="1"||t==="2"?this.selectSlot(parseInt(t)):t==="e"&&this.state.selectedSlot===2&&this.useMedkit()}selectSlot(e){this.state.selectedSlot=e,this.ui.gunSlot.style.border=e===1?"2px solid #4a9eff":"2px solid #666",this.ui.medkitSlot.style.border=e===2?"2px solid #4a9eff":"2px solid #666"}useMedkit(){const{medkit:e}=this.state.items;e.uses>0&&this.state.currentHealth<this.config.maxHealth&&(e.uses--,this.state.currentHealth=Math.min(this.config.maxHealth,this.state.currentHealth+e.healAmount),this.updateUI(),this.showEffect("heal"))}takeDamage(e){return this.state.currentHealth=Math.max(0,this.state.currentHealth-e),this.updateUI(),this.showEffect("damage"),this.state.currentHealth<=0}canFire(){return this.state.selectedSlot===1&&this.state.lastFired<=0}fire(){return this.canFire()?(this.state.lastFired=this.state.items.weapon.fireRate,this.state.items.weapon.damage):0}update(e){this.state.lastFired>0&&(this.state.lastFired-=e)}showEffect(e){const t=document.createElement("div");Object.assign(t.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:e==="heal"?"rgba(0, 255, 0, 0.2)":"rgba(255, 0, 0, 0.2)",pointerEvents:"none",transition:"opacity 0.2s",zIndex:"999"}),document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>document.body.removeChild(t),200)},100)}getHealth(){return this.state.currentHealth}getMedkitUses(){return this.state.items.medkit.uses}getSelectedSlot(){return this.state.selectedSlot}}class qs{constructor(e={}){this.config={totalEnemies:e.totalEnemies||10,...e},this.state={enemiesKilled:0},this.ui={},this.initializeUI()}createContainer(){const e=document.createElement("div");return Object.assign(e.style,{position:"fixed",top:"20px",right:"20px",padding:"15px",background:"rgba(0, 0, 0, 0.7)",borderRadius:"8px",color:"white",fontFamily:"Arial, sans-serif",userSelect:"none",zIndex:"1000",display:"flex",flexDirection:"column",gap:"10px",minWidth:"200px"}),e}createKillDisplay(){const e=document.createElement("div");Object.assign(e.style,{fontSize:"16px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px"});const t=document.createElement("span");t.textContent="💀",Object.assign(t.style,{fontSize:"20px"});const s=document.createElement("span");return s.textContent=`${this.state.enemiesKilled}/${this.config.totalEnemies}`,e.appendChild(t),e.appendChild(s),e}createMissionText(){const e=document.createElement("div");Object.assign(e.style,{fontSize:"14px",color:"#aaa",borderTop:"1px solid rgba(255, 255, 255, 0.2)",paddingTop:"8px",textAlign:"center"});const t=document.createElement("span");t.textContent="🎯 ";const s=document.createElement("span");return s.textContent=`Kill ${this.config.totalEnemies} enemies`,e.appendChild(t),e.appendChild(s),e}initializeUI(){this.ui.container=this.createContainer(),this.ui.killDisplay=this.createKillDisplay(),this.ui.missionText=this.createMissionText(),this.ui.container.appendChild(this.ui.killDisplay),this.ui.container.appendChild(this.ui.missionText),document.body.appendChild(this.ui.container)}updateUI(){const e=this.ui.killDisplay.querySelector("span:last-child");e&&(e.textContent=`${this.state.enemiesKilled}/${this.config.totalEnemies}`),this.state.enemiesKilled===this.config.totalEnemies&&(Object.assign(this.ui.missionText.style,{color:"#4caf50",fontWeight:"bold"}),this.ui.missionText.querySelector("span:last-child").textContent=`Kill ${this.config.totalEnemies} enemies - Completed!`,this.showVictoryEffect())}incrementKills(){return this.state.enemiesKilled<this.config.totalEnemies?(this.state.enemiesKilled++,this.updateUI(),this.showKillEffect(),!0):!1}showKillEffect(){const e=document.createElement("div");Object.assign(e.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(255, 215, 0, 0.1)",pointerEvents:"none",transition:"opacity 0.2s",zIndex:"999"}),document.body.appendChild(e),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>document.body.removeChild(e),200)},100)}showVictoryEffect(){const e=document.createElement("div");Object.assign(e.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"20px 40px",background:"rgba(0, 0, 0, 0.8)",borderRadius:"12px",color:"gold",fontSize:"24px",fontWeight:"bold",textAlign:"center",zIndex:"1001",animation:"fadeIn 0.5s ease-in"});const t=document.createElement("style");t.textContent=`
            @keyframes fadeIn {
                from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            }
        `,document.head.appendChild(t),e.textContent="🏆 Victory! All Enemies Defeated! 🏆, You can now opem the door",document.body.appendChild(e),setTimeout(()=>{e.style.opacity="0",e.style.transition="opacity 0.5s",setTimeout(()=>document.body.removeChild(e),500)},3e3)}getKillCount(){return this.state.enemiesKilled}getTotalEnemies(){return this.config.totalEnemies}reset(){this.state.enemiesKilled=0,Object.assign(this.ui.missionText.style,{color:"#aaa",fontWeight:"normal"}),this.ui.missionText.querySelector("span:last-child").textContent=`Kill ${this.config.totalEnemies} enemies`,this.updateUI()}}class ut{constructor(e={}){this.config={intensity:e.intensity||.5,flickerSpeed:e.flickerSpeed||1,minOpacity:e.minOpacity||.1,maxOpacity:e.maxOpacity||.3,...e},this.light=null,this.isActive=!0,this.time=0,this.initializeLight(),this.startAnimation()}initializeLight(){this.light=document.createElement("div"),Object.assign(this.light.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"red",opacity:"0",pointerEvents:"none",zIndex:"9999",transition:"opacity 0.05s ease-in-out",mixBlendMode:"multiply"}),document.body.appendChild(this.light)}startAnimation(){let e=performance.now();const t=s=>{if(!this.isActive)return;const n=(s-e)/1e3;e=s,this.time+=n*this.config.flickerSpeed;const o=this.calculateFlicker();this.light&&(this.light.style.opacity=o.toString()),requestAnimationFrame(t)};requestAnimationFrame(t)}calculateFlicker(){const e=Math.sin(this.time*10)*.5+.5,t=Math.sin(this.time*25)*.25+.75,s=Math.sin(this.time*3)*.15+.85;let n=e*t*s;return n*=.9+Math.random()*.2,this.lerp(this.config.minOpacity,this.config.maxOpacity,n*this.config.intensity)}lerp(e,t,s){return e*(1-s)+t*s}setIntensity(e){this.config.intensity=Math.max(0,Math.min(1,e))}setFlickerSpeed(e){this.config.flickerSpeed=e}setOpacityRange(e,t){this.config.minOpacity=e,this.config.maxOpacity=t}start(){this.isActive=!0,this.startAnimation()}stop(){this.isActive=!1,this.light&&(this.light.style.opacity="0")}destroy(){this.stop(),this.light&&this.light.parentNode&&this.light.parentNode.removeChild(this.light),this.light=null}}class Ys{constructor(e){this.scene=e,this.medkits=[],this.loader=new ee,this.pickupSound=new Audio("/pickup.mp3")}createMedKit(e){this.loader.load("./medkit/scene.gltf",t=>{const s=t.scene,n={model:s,isCollected:!1,healAmount:50};s.position.set(e[0],e[1],e[2]),s.scale.set(1,1,1),s.rotation.set(0,0,0),s.traverse(o=>{o.isMesh&&(o.castShadow=!0,o.receiveShadow=!0)}),this.addFloatingAnimation(s),this.scene.add(s),this.medkits.push(n)},t=>{console.log(t.loaded/t.total*100+"% loaded")},t=>{console.error("An error happened while loading the medkit model:",t)})}addFloatingAnimation(e){const t=e.position.y,s=.5,n=1.5;e.userData.animate=o=>{e.position.y=t+Math.sin(o*n)*s,e.rotation.y+=.01}}updateMedKits(e){this.medkits.forEach(t=>{!t.isCollected&&t.model&&t.model.userData.animate(e)})}handlePlayerCollision(e,t=2){const s=new C().setFromCenterAndSize(e,new x(t,t,t));for(let n=this.medkits.length-1;n>=0;n--){const o=this.medkits[n];if(!o.model||o.isCollected)continue;const i=new C().setFromObject(o.model);if(s.intersectsBox(i))return this.collectMedKit(n),o.healAmount}return 0}collectMedKit(e){const t=this.medkits[e];if(!t||t.isCollected)return;t.isCollected=!0,this.pickupSound.currentTime=0,this.pickupSound.play().catch(a=>console.log("Error playing pickup sound:",a));const s=t.model,n=.5,o=Date.now(),i=()=>{const a=(Date.now()-o)/1e3,r=Math.min(a/n,1);s.scale.setScalar(1-r),r<1?requestAnimationFrame(i):this.removeMedKit(e)};i()}removeMedKit(e){const t=this.medkits[e];t&&t.model&&(this.scene.remove(t.model),this.medkits.splice(e,1))}removeAllMedKits(){[...this.medkits].forEach((e,t)=>{this.removeMedKit(t)}),this.medkits=[]}spawnMedKitAtRandomPosition(e={minX:-100,maxX:100,minZ:-100,maxZ:100}){const t=[Math.random()*(e.maxX-e.minX)+e.minX,1,Math.random()*(e.maxZ-e.minZ)+e.minZ];this.createMedKit(t)}}function $s(l){return new Ys(l)}class Qs{constructor(e){this.scene=e,this.armorPickups=[],this.loader=new ee,this.pickupSound=new Audio("/armor-pickup.mp3"),this.position=new x}createArmorPickup(e=this.position){this.loader.load("./public/9mm_ammo_box/scene.gltf",t=>{const s=t.scene,n=new Pe(35071,5);n.position.copy(e).add(new x(0,5,0)),n.target=s,n.angle=Math.PI/6,n.penumbra=.3,n.distance=10,n.decay=2,n.castShadow=!0,n.shadow.mapSize.width=512,n.shadow.mapSize.height=512,n.shadow.camera.near=.5,n.shadow.camera.far=15,n.shadow.focus=1;const o={model:s,spotlight:n,isCollected:!1,armorAmount:25,spawnTime:Date.now(),position:e.clone()};s.position.copy(e),s.scale.set(1,1,1),s.rotation.set(0,0,0),s.traverse(i=>{i.isMesh&&(i.castShadow=!0,i.receiveShadow=!0)}),this.addSpawnAnimation(s),this.addFloatingAnimation(s,n),this.scene.add(s),this.scene.add(n),this.armorPickups.push(o)})}addSpawnAnimation(e){e.scale.set(0,0,0);const t=Date.now(),s=500,n=()=>{const o=Date.now()-t,i=Math.min(o/s,1),a=this.easeElasticOut(i);e.scale.setScalar(a),i<1&&requestAnimationFrame(n)};n()}easeElasticOut(e){const t=2*Math.PI/3;return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*t)+1}addFloatingAnimation(e,t){const s=e.position.y,n=.5,o=1.2,i=.015;e.userData.animate=a=>{const r=s+Math.sin(a*o)*n;e.position.y=r,e.rotation.y+=i,t&&(t.position.y=r+5)}}updateArmorPickups(e){this.armorPickups.forEach(t=>{!t.isCollected&&t.model&&(t.model.userData.animate(e),t.spotlight&&(t.spotlight.intensity=5+Math.sin(e*1.5)*2))})}handlePlayerCollision(e,t=2){const s=new C().setFromCenterAndSize(e,new x(t,t,t));for(let n=this.armorPickups.length-1;n>=0;n--){const o=this.armorPickups[n];if(!o.model||o.isCollected)continue;const i=new C().setFromObject(o.model);if(s.intersectsBox(i))return this.collectArmorPickup(n),o.armorAmount}return 0}collectArmorPickup(e){const t=this.armorPickups[e];if(!t||t.isCollected)return;t.isCollected=!0,this.pickupSound.currentTime=0,this.pickupSound.play().catch(r=>console.log("Error playing armor pickup sound:",r));const s=t.model,n=t.spotlight,o=.5,i=Date.now(),a=()=>{const r=(Date.now()-i)/1e3,c=Math.min(r/o,1);s.scale.setScalar(1-c),s.rotation.y+=.2,n&&(n.intensity=5*(1-c)),c<1?requestAnimationFrame(a):this.removeArmorPickup(e)};a()}removeArmorPickup(e){const t=this.armorPickups[e];t&&(t.model&&this.scene.remove(t.model),t.spotlight&&this.scene.remove(t.spotlight),this.armorPickups.splice(e,1))}removeAllArmorPickups(){[...this.armorPickups].forEach((e,t)=>{this.removeArmorPickup(t)}),this.armorPickups=[]}}function Zs(l){return new Qs(l)}let mt=0,ce=!1;const he=new zs(100,100,{position:{top:"50px",left:"50px"},width:"300px",barHeight:"25px",barColors:{high:"#00ff00",medium:"#ffff00",low:"#ff0000"}}),$e=new Vs("Amazing Game",{backgroundColor:"#1a1a1a",titleColor:"#ffffff",loadingColor:"#cccccc",dotColors:["#ff3366","#33ff66","#3366ff"],fontSize:{title:"64px",loading:"32px"}}),pt=new qs({totalEnemies:3}),pe=new Xs({maxHealth:100,medkitHealAmount:25,initialMedkits:3,gunDamage:20,fireRate:.5});pe.initializeUI();const de=new ut;new ut({intensity:.7,flickerSpeed:1.5,minOpacity:.1,maxOpacity:.3});de.setIntensity(.8);de.setFlickerSpeed(2);de.stop();de.start();de.destroy();he.mount();he.setHealth(100);he.onGameOver=()=>{Js()};const ae=new Ws(30,30,{position:{top:"100px",left:"20px"},reloadTime:1500,barColors:{full:"#00ff00",medium:"#ffff00",low:"#ff0000",reloading:"#0088ff"}});ae.mount();function Js(){ce=!1;const l=document.createElement("div");l.style.position="fixed",l.style.top="50%",l.style.left="50%",l.style.transform="translate(-50%, -50%)",l.style.backgroundColor="rgba(0, 0, 0, 0.8)",l.style.color="white",l.style.padding="20px",l.style.textAlign="center",l.style.borderRadius="10px",l.innerHTML=`
        <h2>Game Over</h2>
        <button onclick="window.location.reload()">Retry</button>
    `,document.body.appendChild(l)}const en=document.getElementById("myAudio");en.volume=.05;const L=new Qt;let ye=new Gs(L),we=ye.getWallBoundingBoxes();const Y=Ks(L),K=new rt(75,window.innerWidth/window.innerHeight,.1,1e3),V=new Zt({antialias:!0});V.setSize(window.innerWidth,window.innerHeight);V.shadowMap.enabled=!0;V.shadowMap.type=ct;document.body.appendChild(V.domElement);window.addEventListener("resize",()=>{K.aspect=window.innerWidth/window.innerHeight,K.updateProjectionMatrix(),V.setSize(window.innerWidth,window.innerHeight)});new Jt(15728640,.1);const ft=new z(new ge(5,5,5),new W({color:16711680}));ft.position.set(0,2.5,0);const Q=new tt(16776960,.2);Q.position.set(5,10,7.5);Q.castShadow=!0;Q.shadow.mapSize.width=1024;Q.shadow.mapSize.height=1024;Q.shadow.camera.near=.5;Q.shadow.camera.far=50;L.add(Q);const tn=new es(50,50),sn=new W({color:8421504,depthWrite:!1}),Fe=new z(tn,sn);Fe.rotation.x=-Math.PI/2;Fe.receiveShadow=!0;L.add(Fe);const Ne=new ee;let U,p,R,F,k,le;const ve=$s(L),nn=Zs(L),on=new ns,S={};window.addEventListener("keydown",l=>{ce&&(S[l.key.toLowerCase()]=!0)});window.addEventListener("keyup",l=>{ce&&(S[l.key.toLowerCase()]=!1)});let Qe=.002,me=0;const Ze=Math.PI/2;document.body.requestPointerLock=document.body.requestPointerLock||document.body.mozRequestPointerLock||document.body.webkitRequestPointerLock;document.body.onclick=()=>{document.body.requestPointerLock()};window.addEventListener("mousemove",l=>{const e=l.movementX||l.mozMovementX||l.webkitMovementX||0,t=l.movementY||l.mozMovementY||l.webkitMovementY||0;p&&(p.rotation.y-=e*Qe,me-=t*Qe,me=Math.max(-Ze,Math.min(Ze,me)),K.rotation.x=me)});document.addEventListener("pointerlockchange",()=>{document.pointerLockElement===document.body?console.log("Pointer lock activated"):console.log("Pointer lock deactivated")});window.addEventListener("mousedown",l=>{l.button===0&&(ae.currentAmmo==0?ae.reload():rn())});new is;new x;new x;const ie=[];window.singletons={audio:document.getElementById("myAudio"),shootSound:new Audio("./public/shot.mp3")};function rn(){if(!F){console.warn("Shooting action is not available.");return}F.isRunning()||(R&&R.isRunning()&&(R.paused=!0),F.reset(),F.play(),ae.useAmmo(),window.singletons.shootSound.playbackRate=1,window.singletons.shootSound.play().then(()=>{console.log("Sound is playing")}).catch(l=>console.log("Error playing sound: ",l)),U.addEventListener("finished",gt),pn())}function gt(l){l.action===F&&(U.removeEventListener("finished",gt),(S.w||S.arrowup||S.s||S.arrowdown)&&R&&(R.paused=!1))}const an={};for(let l=0;l<3;l++){const e=new ge(3,3,3),t=new W({color:Math.random()*16777215}),s=new z(e,t);s.position.set(l*5-5,.5,-10),s.castShadow=!0,s.receiveShadow=!0,an[s.uuid]=0}Ne.load("./public/obn_2.glb",function(l){if(p=l.scene,p.scale.set(.3,.3,.3),p.rotation.y=Math.PI,p.position.set(0,0,0),p.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),L.add(p),Y.setTarget(p.position),Y.startSpawning(5e3,5),U=new lt(p),l.animations&&l.animations.length){const e=Le.findByName(l.animations,"npc_walk_pistol");e?(R=U.clipAction(e),R.setLoop(ze,1/0),R.play(),R.paused=!0):(R=U.clipAction(l.animations[0]),R.setLoop(ze,1/0),R.play(),R.paused=!0,console.warn('Walk animation "npc_walk_pistol" not found. Using the first available animation.'));const t=Le.findByName(l.animations,"npc_shooting_pistol");t&&(F=U.clipAction(t),F.setLoop(Ie,1),F.clampWhenFinished=!0,F.stop())}ln()},function(l){console.log(`${l.loaded/l.total*100}% loaded`)},function(l){console.error("An error occurred while loading the player model:",l)});function ln(){Ne.load("./public/gun.glb",function(l){k=l.scene,k.scale.set(3.5,3.5,3.5),console.log("Gun model structure:",k),p.traverse(t=>{t.isBone?console.log("Bone:",t.name):t.isMesh&&(console.log("Mesh:",t.name),t.castShadow=!0,t.receiveShadow=!0)}),cn(k);const e=p.getObjectByName("mixamorigRightHand");if(e){e.add(k),k.position.set(.1,.6,.35);const t=new x(Math.sin(p.rotation.y),0,Math.cos(p.rotation.y)).normalize(),s=new Ae;s.setFromUnitVectors(new x(-4.5,5,-.4),t),k.quaternion.copy(s),console.log("Gun attached to player's hand")}else k.position.set(.5,1.2,.3),p.add(k);dn()},function(l){console.log(`${l.loaded/l.total*100}% loaded`)},function(l){console.error("An error occurred while loading the gun model:",l)})}function cn(l){const e=new B,t=new Pe(16777215,100);t.angle=Math.PI/12,t.penumbra=.2,t.decay=.2,t.distance=100,t.castShadow=!0,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.camera.near=.1,t.shadow.camera.far=150,t.shadow.focus=1;const s=new z(new ts(.03,16),new W({color:16777215,emissive:16777215,emissiveIntensity:1})),n=new xe;t.position.copy(l.position),n.position.set(15,-3,0);const o=new ss(t);e.add(t),e.add(n),l.add(e),t.target=n,l.userData.flashlight=t,l.userData.flashlightLens=s,l.userData.flashlightTarget=n,l.userData.flashlightHelper=o;function i(){o&&o.update(),requestAnimationFrame(i)}i();function a(){if(t.intensity>0){const c=Math.random()*.2-.1;t.intensity=5+c,s.material.emissiveIntensity=.8+c}requestAnimationFrame(a)}return a(),l.userData.toggleFlashlight=function(){console.log("Toggling flashlight"),t.intensity>0?(console.log("Turning flashlight off"),t.intensity=0,s.material.emissiveIntensity=0):(console.log("Turning flashlight on"),t.intensity=10,s.material.emissiveIntensity=1)},document.addEventListener("keydown",r=>{r.key.toLowerCase()==="f"&&(console.log("F key pressed"),l.userData.toggleFlashlight())}),V.shadowMap.enabled=!0,V.shadowMap.type=ct,e}function hn(){k&&k.userData.flashlightHelper&&k.userData.flashlightHelper.update()}function dn(){Ne.load("./public/bullet.glb",l=>{le=l.scene,le.scale.set(.01,.01,.01)})}function un(l){for(let e=ie.length-1;e>=0;e--){const t=ie[e];if(t.position.add(t.userData.velocity.clone().multiplyScalar(l*1.4)),t.position.length()>100){L.remove(t),ie.splice(e,1);continue}Y.ghosts.forEach((s,n)=>{if(!s.model)return;const o=new C().setFromObject(s.model),i=new C().setFromObject(t);o.intersectsBox(i)&&(s.hitCount||(s.hitCount=0),s.hitCount++,Y.playHitAnimation(s),s.hitCount>=2&&(ve.createMedKit([s.model.position.x,1,s.model.position.z]),nn.createArmorPickup([s.model.position.x+1,1,s.model.position.z+1]),Y.removeGhost(n),pt.incrementKills(),mt+=1),L.remove(t),ie.splice(e,1))})}}function mn(){p&&(new C().setFromObject(p),Y.ghosts.forEach(l=>{if(!l.model)return;let e=l.model.position.x*l.model.position.x-p.position.x*p.position.x,t=l.model.position.y*l.model.position.y-p.position.y*p.position.y;e*e+t*t<5&&(pe.takeDamage(.1),he.setHealth(pe.getHealth()),console.warn(pe.getHealth()))}))}function pn(){if(!le){console.error("Bullet model is not loaded.");return}const l=le.clone(),e=new x;k.getWorldPosition(e),l.position.copy(e);const t=new x(0,0,1);t.applyQuaternion(p.quaternion),l.rotation.set(0,0,0),l.quaternion.copy(p.quaternion);const s=new Ae;s.setFromUnitVectors(new x(0,0,1),t.normalize()),l.quaternion.premultiply(s);const n=new x(0,0,0);n.applyQuaternion(k.quaternion),l.position.add(n),l.userData={velocity:t.clone().multiplyScalar(25)},L.add(l),ie.push(l)}const ue=document.getElementById("startMenu"),yt=document.getElementById("optionsScreen"),wt=document.getElementById("creditsScreen"),fn=document.getElementById("startButton"),gn=document.getElementById("optionsButton"),yn=document.getElementById("creditsButton"),xt=document.getElementById("saveOptionsButton"),wn=document.getElementById("closeCreditsButton");fn.addEventListener("click",()=>{ue.style.display="none",ce=!0});gn.addEventListener("click",()=>{ue.style.display="none",yt.style.display="flex"});yn.addEventListener("click",()=>{ue.style.display="none",wt.style.display="flex"});xt.addEventListener("click",()=>{console.log("Options saved"),yt.style.display="none",ue.style.display="flex"});wn.addEventListener("click",()=>{wt.style.display="none",ue.style.display="flex"});function xn(){const l=document.getElementById("difficulty").value,e=document.getElementById("mouseSensitivity").value,t=document.getElementById("soundVolume").value,s=document.getElementById("graphicsQuality").value,n=document.getElementById("fov").value;console.log("Applying options:",{difficulty:l,mouseSensitivity:e,soundVolume:t,graphicsQuality:s,fov:n})}xt.addEventListener("click",xn);function An(){if(!p)return;const l=new C().setFromObject(p);ve.medkits.forEach((e,t)=>{const s=new C().setFromObject(e.model);l.intersectsBox(s)&&(L.remove(e.model),ve.medkits.splice(t,1),he.setHealth(100))})}function Tn(l,e){const t=new x().copy(p.position);let s=new C().setFromObject(p),n=!1,o=!1;p.position.x+=l,s.setFromObject(p);for(const i of we)if(s.intersectsBox(i)){n=!0,p.position.x=t.x;break}p.position.z+=e,s.setFromObject(p);for(const i of we)if(s.intersectsBox(i)){o=!0,p.position.z=t.z;break}return n&&!o&&(p.position.z=t.z+e),o&&!n&&(p.position.x=t.x+l),{collidedX:n,collidedZ:o}}let J;function bn(l,e){const t=l.distanceTo(e),s=3;console.log(pt.getKillCount),t<=s?(Mn(),S.e&&(mt>=3?(Rn(),ye.clearScene(),we=[],En(),setTimeout(()=>{Sn()},3e3)):(J=document.getElementById("door-popup"),J.style.display="block",J.innerHTML="Defeat all Monsters to open the door"))):Cn()}function En(){ye=new Hs(L,p),we=ye.getWallBoundingBoxes(),console.log("Level 2 loaded!")}function Rn(){const l=document.getElementById("loading-screen");l.style.display="block"}function Sn(){const l=document.getElementById("loading-screen");l.style.display="none"}function Mn(){J=document.getElementById("door-popup"),J.style.display="block",J.innerHTML="Press E to open the door"}function Cn(){const l=document.getElementById("door-popup");l.style.display="none"}function kn(){if(requestAnimationFrame(kn),p&&k&&le){$e.unmount(),hn(),An();const l=on.getDelta();mn(),U&&U.update(l);const e=5*l,t=Math.PI*l;let s=!1;if(ft.rotation.y+=.01,Us(Y,l),p){let n=0,o=0;if((S.w||S.arrowup)&&(o=e*Math.cos(p.rotation.y),n=e*Math.sin(p.rotation.y),s=!0),(S.s||S.arrowdown)&&(o=-e*Math.cos(p.rotation.y),n=-e*Math.sin(p.rotation.y),s=!0),Tn(n,o),(S.a||S.arrowleft)&&(p.rotation.y+=t),(S.d||S.arrowright)&&(p.rotation.y-=t),bn(p.position,new x(-23.83,1.6,-24.9)),Oe){const i=new x(0,3,-8),a=.1,r=new x().copy(p.position).add(i.clone().applyAxisAngle(new x(0,1,0),p.rotation.y));K.position.lerp(r,a);const c=new x().copy(p.position).add(new x(0,2,0));K.lookAt(c)}else{const i=new x(0,6,1.5),a=new x().copy(i).applyMatrix4(p.matrixWorld);K.position.copy(a);const r=new x(Math.sin(p.rotation.y),0,Math.cos(p.rotation.y)).normalize(),c=new x().copy(p.position).add(r);K.lookAt(c.x,p.position.y+1.5,c.z)}}R&&(s?R.paused&&(R.paused=!1):R.paused||(R.paused=!0)),un(l),V.render(L,K)}else ce&&$e.mount()}const P=document.createElement("div");P.style.position="fixed";P.style.bottom="20px";P.style.right="20px";P.style.padding="10px 20px";P.style.backgroundColor="rgba(0, 0, 0, 0.7)";P.style.color="white";P.style.borderRadius="5px";P.style.fontFamily="Arial, sans-serif";P.style.zIndex="1000";document.body.appendChild(P);let Oe=!1;document.addEventListener("keydown",l=>{const e=l.key.toLowerCase();S[e]=!0,e==="c"&&(Oe=!Oe),e==="r"&&ae.reload()});document.addEventListener("keyup",l=>{const e=l.key.toLowerCase();delete S[e]});class Ln{constructor(){this.isThirdPerson=!1,this.createToggleElement(),this.addEventListeners()}createToggleElement(){this.container=document.createElement("div"),this.container.style.cssText=`
          position: fixed;
          bottom: 0px;
          right: 20px;
          display: flex;
          align-items: center;
          background-color: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 10px;
          border-radius: 8px;
          cursor: pointer;
          user-select: none;
          font-family: Arial, sans-serif;
          z-index: 1000;
      `,this.iconSvg=this.createCameraIcon(),this.container.appendChild(this.iconSvg),this.modeText=document.createElement("span"),this.modeText.style.marginLeft="10px",this.container.appendChild(this.modeText),this.updateMode(),document.body.appendChild(this.container)}createCameraIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","white"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"),e.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","circle");return s.setAttribute("cx","12"),s.setAttribute("cy","13"),s.setAttribute("r","3"),e.appendChild(s),e}updateMode(){this.modeText.textContent=this.isThirdPerson?"Third Person Mode":"First Person Mode",this.container.style.backgroundColor="rgba(0, 100, 255, 0.7)",setTimeout(()=>{this.container.style.backgroundColor="rgba(0, 0, 0, 0.7)"},200)}addEventListeners(){document.addEventListener("keydown",e=>{e.key.toLowerCase()==="c"&&(this.isThirdPerson=!this.isThirdPerson,this.updateMode())})}}new Ln;export{kn as animate,L as scene};
